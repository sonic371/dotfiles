#!/bin/bash
# Initialize dotfiles repository

set -e

DOTFILES="$HOME/dotfiles"

echo "ðŸ“ Setting up dotfiles repository..."

# Create directory
if [ ! -d "$DOTFILES" ]; then
    mkdir -p "$DOTFILES"
    echo "Created $DOTFILES"
fi

cd "$DOTFILES"

# Initialize git if not already
if [ ! -d ".git" ]; then
    git init
    echo "# My Dotfiles" > README.md
    echo ".DS_Store" > .gitignore
    echo "*.swp" >> .gitignore
    echo "*.swo" >> .gitignore
    echo "*.backup.*" >> .gitignore
    git add README.md .gitignore
    git commit -m "Initial commit"
    echo "Git repository initialized"
fi

# Install stow if needed
if ! command -v stow &> /dev/null; then
    echo "Installing stow..."
    if command -v apt &> /dev/null; then
        sudo apt install stow
    elif command -v pacman &> /dev/null; then
        sudo pacman -S stow
    elif command -v brew &> /dev/null; then
        brew install stow
    else
        echo "Please install 'stow' manually"
    fi
fi

# Create helper scripts
cat > "$DOTFILES/dotfiles-add" << 'EOF'
#!/bin/bash
# ... (paste the first script here)
EOF

cat > "$DOTFILES/dotfiles-list" << 'EOF'
#!/bin/bash
# List managed dotfiles
echo "Managed dotfiles:"
for dir in */; do
    if [ -d "$dir/.config" ] || [ -f "$dir/."* ]; then
        echo "  ${dir%/}"
    fi
done
EOF

chmod +x "$DOTFILES/dotfiles-add" "$DOTFILES/dotfiles-list"

echo ""
echo "âœ… Dotfiles setup complete!"
echo ""
echo "Available commands:"
echo "  cd ~/dotfiles && ./dotfiles-add <config-name>"
echo "  ./dotfiles-list                          # List managed configs"
echo ""
echo "Common configs to add:"
echo "  ./dotfiles-add polybar"
echo "  ./dotfiles-add i3"
echo "  ./dotfiles-add alacritty"
echo "  ./dotfiles-add zsh ~/.zshrc"
