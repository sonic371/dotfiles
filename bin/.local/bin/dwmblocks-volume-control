#!/bin/sh
# Display the current time in HH:MM:SS.

# Set default terminal if not defined
TERMINAL="${TERMINAL:-st}"

notify() {
    notify-send --icon=office-calendar-symbolic \
        --hint=string:x-canonical-private-synchronous:"$1" "$@"
}

case $BLOCK_BUTTON in
    1)
        notify "This Month" "$(cal --color=always |
            sed "s|..7m|<span color='$(xrdb -get color1)'>|;s|..0m|</span>|")"
        appointments="$(calcurse -d1 \
            --format-apt "• <i>%S - %E</i>\n  <span foreground='$(xrdb -get color6)'>%m</span>\n" \
            --format-event "• <span foreground='$(xrdb -get color6)'>%m</span>\n")"
        [ -n "$appointments" ] && notify "Appointments" "$appointments"
        ;;
    2) 
        # Define terminal-specific options for window name
        case "$TERMINAL" in
            kitty)
                opts=(--name "calcurse")
                ;;
            st)
                opts=(-n "calcurse")
                ;;
            *)
                opts=()
                ;;
        esac
        $TERMINAL "${opts[@]}" -e calcurse
        ;;
    6) 
        # Define terminal-specific options for window name (editor)
        case "$TERMINAL" in
            kitty)
                opts=(--name "editor")
                ;;
            st)
                opts=(-n "editor")
                ;;
            *)
                opts=()
                ;;
        esac
        $TERMINAL "${opts[@]}" -e "$EDITOR" "$0"
        ;;
esac

. sb-theme
display "󰥔 $(date '+%H:%M:%S')"
# Get volume percentage
volume_info=$(pactl get-sink-volume @DEFAULT_SINK@ 2>/dev/null)

# Extract the percentage
if [[ $volume_info =~ ([0-9]+)% ]]; then
    volume="${BASH_REMATCH[1]}"
else
    volume="?"
fi

# Ensure volume doesn't exceed 150% (in case it was already above)
if [[ $volume =~ ^[0-9]+$ ]] && (( volume > 150 )); then
    pactl set-sink-volume @DEFAULT_SINK@ 150% 2>/dev/null
    volume=150
fi

# Select icon
if (( volume > 50 )); then
    icon=" "
elif (( volume > 15 )); then
    icon=" "
else
    icon=" "
fi

echo "$icon$volume%"
